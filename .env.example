# ===========================================
# NexusNote 环境配置模板 (2026 Modern Stack)
# ===========================================
# 复制此文件为 .env 并填入你的配置
# Fullstack Next.js 架构（单一 Docker 容器）

# ===========================================
# 数据库（必需）
# ===========================================
DATABASE_URL=postgresql://user:password@localhost:5432/nexusnote

# ===========================================
# Redis（必需 - 用于队列和分布式锁）
# ===========================================
REDIS_URL=redis://localhost:6379

# ===========================================
# 服务器配置
# ===========================================

# 应用监听端口
PORT=3002

# Hocuspocus WebSocket 服务器端口
HOCUSPOCUS_PORT=1234

# ===========================================
# 认证（必需）
# ===========================================

# NextAuth 5.x 加密密钥（生产环境：openssl rand -base64 32）
AUTH_SECRET=your-random-32-char-auth-secret-change-in-production

# JWT 签名密钥
JWT_SECRET=your-random-32-char-secret-key-change-in-production

# JWT 过期时间
JWT_EXPIRES_IN=7d

# JWT 颁发者
JWT_ISSUER=nexusnote

# ===========================================
# AI Provider（必需 - 至少配置一个）
# ===========================================

# 302.ai API Key（推荐 - 支持所有模型）
AI_302_API_KEY=sk-your-302ai-api-key

# DeepSeek API Key（备选）
DEEPSEEK_API_KEY=sk-your-deepseek-api-key

# OpenAI API Key（备选）
OPENAI_API_KEY=sk-your-openai-api-key

# SiliconFlow API Key（备选 - 国内用户推荐）
SILICONFLOW_API_KEY=sk-your-siliconflow-api-key

# Tavily API Key（可选 - 用于实时 Web 搜索）
TAVILY_API_KEY=your-tavily-api-key

# ===========================================
# AI 可观测性（可选 - 推荐用于生产环境）
# ===========================================

# Langfuse API Keys（AI SDK v6 官方推荐）
# 功能：自动追踪 tokens、成本、延迟、工具调用
# 注册地址：https://langfuse.com/signup（免费）
LANGFUSE_PUBLIC_KEY=pk-lf-your-public-key
LANGFUSE_SECRET_KEY=sk-lf-your-secret-key

# ===========================================
# AI 模型配置（可选 - 有默认值）
# ===========================================

# 通用模型 - 用于对话、Agent、快速任务
AI_MODEL=gemini-3-flash-preview

# Pro 模型 - 用于复杂推理、长文本生成
AI_MODEL_PRO=gemini-3-pro-preview

# 联网搜索模型 - 集成实时搜索能力
AI_MODEL_WEB_SEARCH=gemini-3-flash-preview-web-search

# ===========================================
# Embedding 配置
# ===========================================

# Embedding 模型（4000 维的高质量向量）
EMBEDDING_MODEL=Qwen/Qwen3-Embedding-8B

# Embedding 维度（需与数据库 halfvec 配置一致）
EMBEDDING_DIMENSIONS=4000

# ===========================================
# Reranker 配置（可选 - 提高 RAG 精度）
# ===========================================

# Reranker 模型
RERANKER_MODEL=Qwen/Qwen3-Reranker-8B

# 启用 Reranker（两阶段检索）
RERANKER_ENABLED=false

# ===========================================
# RAG 高级优化（可选）
# ===========================================

# Query Rewriting - 用 LLM 优化用户查询
QUERY_REWRITING_ENABLED=false

# Hybrid Search - 结合向量检索和关键词检索
HYBRID_SEARCH_ENABLED=false

# Context Compression - 压缩检索结果，降低成本
CONTEXT_COMPRESSION_ENABLED=false

# 快速模型 - 用于轻量任务
AI_FAST_MODEL=gemini-3-flash-preview

# ===========================================
# RAG 索引参数
# ===========================================

# 文本分块大小（字符数）
RAG_CHUNK_SIZE=500

# 分块之间的重叠（用于上下文连贯性）
RAG_CHUNK_OVERLAP=50

# RAG 搜索超时（毫秒）
RAG_TIMEOUT=5000

# 搜索重试次数
RAG_RETRIES=2

# 相似度阈值（0-1，越高越严格）
RAG_SIMILARITY_THRESHOLD=0.3

# ===========================================
# BullMQ 队列配置
# ===========================================

# Worker 并发处理任务数
QUEUE_RAG_CONCURRENCY=3

# 失败重试次数
QUEUE_RAG_MAX_RETRIES=3

# 重试延迟（毫秒）
QUEUE_RAG_BACKOFF_DELAY=1000

# ===========================================
# 快照和版本控制
# ===========================================

# 自动快照间隔（毫秒，默认 5 分钟）
SNAPSHOT_INTERVAL_MS=300000

# 每个文档最多保留快照数
SNAPSHOT_MAX_PER_DOC=100

# ===========================================
# Notes / Liquid Knowledge 配置
# ===========================================

# 语义聚类阈值（0-1，越小越严格）
NOTES_TOPIC_THRESHOLD=0.25

# ===========================================
# 公共 URLs（前端可访问）
# ===========================================

# 开发环境
NEXT_PUBLIC_API_URL=http://localhost:3002/api
NEXT_PUBLIC_COLLAB_URL=ws://localhost:1234

# 生产环境（部署时修改为你的域名）
# NEXT_PUBLIC_API_URL=https://your-domain.com/api
# NEXT_PUBLIC_COLLAB_URL=wss://your-domain.com

# ===========================================
# 环境
# ===========================================

NODE_ENV=development
# 生产环境改为：NODE_ENV=production

