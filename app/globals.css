@import "tailwindcss";

/* ────────────────────────────────────────────────────────────────────────────
 * Layer 1: Brand Palette (Raw OKLCH values, theme-switchable)
 * ──────────────────────────────────────────────────────────────────────────── */
:root,
[data-theme="default"] {
  /* Low-saturation indigo (h=268) - perceptually uniform across L values */
  --palette-brand-50: oklch(97% 0.03 268);
  --palette-brand-100: oklch(93% 0.05 268);
  --palette-brand-200: oklch(87% 0.08 268);
  --palette-brand-300: oklch(78% 0.11 268);
  --palette-brand-400: oklch(67% 0.14 268);
  --palette-brand-500: oklch(55% 0.18 268); /* Primary brand color */
  --palette-brand-600: oklch(47% 0.17 268);
  --palette-brand-700: oklch(39% 0.15 268);
  --palette-brand-800: oklch(31% 0.12 268);
  --palette-brand-900: oklch(23% 0.09 268);

  /* Neutrals (achromatic zinc-like, slight purple tint) */
  --palette-neutral-50: oklch(98.5% 0.002 270);
  --palette-neutral-100: oklch(96% 0.003 270);
  --palette-neutral-200: oklch(92% 0.005 270);
  --palette-neutral-300: oklch(85% 0.006 270);
  --palette-neutral-400: oklch(70% 0.008 270);
  --palette-neutral-500: oklch(55% 0.01 270);
  --palette-neutral-600: oklch(42% 0.011 270);
  --palette-neutral-700: oklch(32% 0.012 270);
  --palette-neutral-800: oklch(24% 0.013 270);
  --palette-neutral-900: oklch(16% 0.014 270);
}

/* Future theme example (uncomment to switch brand color to green) */
/* [data-theme="forest"] {
  --palette-brand-500: oklch(55% 0.18 145);
  --palette-brand-600: oklch(47% 0.17 145);
} */

/* ────────────────────────────────────────────────────────────────────────────
 * Layer 2: Semantic Tokens (Components reference these)
 * ──────────────────────────────────────────────────────────────────────────── */
@theme {
  /* Background & Surface */
  --color-bg: var(--palette-neutral-50);
  --color-surface: oklch(100% 0 0); /* Pure white for cards */
  --color-surface-elevated: oklch(100% 0 0);

  /* Text */
  --color-text: var(--palette-neutral-900);
  --color-text-secondary: var(--palette-neutral-500);
  --color-text-tertiary: var(--palette-neutral-400);
  --color-text-muted: var(--palette-neutral-300);

  /* Accent (Brand color applications) */
  --color-accent: var(--palette-brand-500);
  --color-accent-hover: var(--palette-brand-600);
  --color-accent-active: var(--palette-brand-700);
  --color-accent-subtle: var(--palette-brand-50);
  --color-accent-muted: var(--palette-brand-100);
  --color-accent-fg: oklch(100% 0 0); /* Foreground on accent background */
  --color-accent-ring: oklch(55% 0.18 268 / 30%);

  /* Interactive States */
  --color-hover: var(--palette-neutral-100);
  --color-active: var(--palette-neutral-200);
  --color-border: var(--palette-neutral-200);
  --color-border-subtle: var(--palette-neutral-100);

  /* Shadcn/Radix Compatibility Bridge (maps to OKLCH tokens) */
  --color-background: var(--color-bg);
  --color-foreground: var(--color-text);
  --color-primary: var(--color-accent);
  --color-primary-foreground: var(--color-accent-fg);
  --color-muted: var(--palette-neutral-100);
  --color-muted-foreground: var(--color-text-secondary);
  --color-card: var(--color-surface);
  --color-card-foreground: var(--color-text);
  --color-input: var(--color-border);
  --color-ring: var(--color-accent);

  /* Radius */
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
  --radius-xl: 1.25rem;
  --radius-2xl: 1.5rem;
  --radius-3xl: 1.75rem;
  --radius-full: 9999px;

  /* Shadow System */
  --shadow-card: 0 2px 8px -2px oklch(0% 0 0 / 5%), 0 4px 20px -4px oklch(0% 0 0 / 8%);
  --shadow-card-hover: 0 4px 16px -4px oklch(0% 0 0 / 10%), 0 12px 32px -8px oklch(0% 0 0 / 12%);
  --shadow-elevated: 0 4px 24px -4px oklch(0% 0 0 / 10%), 0 8px 48px -8px oklch(0% 0 0 / 6%);
  --shadow-elevated-hover: 0 8px 32px -4px oklch(0% 0 0 / 12%), 0 16px 64px -8px oklch(0% 0 0 / 8%);

  /* 技能图颜色 (OKLCH) */
  --skill-frontend-bg: oklch(0.95 0.03 250);
  --skill-frontend-border: oklch(0.85 0.05 250);
  --skill-frontend-text: oklch(0.45 0.12 250);

  --skill-backend-bg: oklch(0.95 0.04 150);
  --skill-backend-border: oklch(0.85 0.06 150);
  --skill-backend-text: oklch(0.45 0.15 150);

  --skill-ml-bg: oklch(0.94 0.06 300);
  --skill-ml-border: oklch(0.82 0.1 300);
  --skill-ml-text: oklch(0.4 0.18 300);

  --skill-design-bg: oklch(0.95 0.05 350);
  --skill-design-border: oklch(0.85 0.08 350);
  --skill-design-text: oklch(0.45 0.15 350);

  --skill-softskill-bg: oklch(0.96 0.04 90);
  --skill-softskill-border: oklch(0.88 0.08 90);
  --skill-softskill-text: oklch(0.5 0.12 90);

  --skill-default-bg: oklch(0.97 0 0);
  --skill-default-border: oklch(0.9 0 0);
  --skill-default-text: oklch(0.4 0 0);

  /* Layout */
  --header-height: 56px;
  --sidebar-width: 280px;
  --message-max-width: 720px;
}

/* ────────────────────────────────────────────────────────────────────────────
 * Layer 3: Dark Mode Overrides
 * ──────────────────────────────────────────────────────────────────────────── */
.dark {
  /* Increase L value for brand colors in dark mode */
  --palette-brand-500: oklch(67% 0.14 268);
  --palette-brand-600: oklch(75% 0.12 268);

  /* Dark backgrounds */
  --color-bg: oklch(14% 0.01 268);
  --color-surface: oklch(18% 0.01 268);
  --color-surface-elevated: oklch(20% 0.01 268);

  /* Inverted text */
  --color-text: oklch(98% 0.002 270);
  --color-text-secondary: oklch(70% 0.008 270);
  --color-text-tertiary: oklch(55% 0.01 270);
  --color-text-muted: oklch(42% 0.011 270);

  /* Adjusted borders */
  --color-border: oklch(32% 0.012 270);
  --color-border-subtle: oklch(24% 0.013 270);
}

/* ────────────────────────────────────────────────────────────────────────────
 * Base Styles
 * ──────────────────────────────────────────────────────────────────────────── */
@layer base {
  * {
    border-color: var(--color-border);
  }

  body {
    background-color: var(--color-bg);
    color: var(--color-text);
    font-feature-settings:
      "rlig" 1,
      "calt" 1;
  }
}

/* Tiptap */
.tiptap {
  outline: none;
  max-width: none;
  padding: 0 1rem;
}

/* ────────────────────────────────────────────────────────────────────────────
 * Mobile Safe Area & Touch Optimization
 * ──────────────────────────────────────────────────────────────────────────── */

/* 安全区域支持 - 刘海屏/底部指示器 */
@supports (padding: env(safe-area-inset-top)) {
  .safe-top {
    padding-top: env(safe-area-inset-top);
  }
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  .safe-left {
    padding-left: env(safe-area-inset-left);
  }
  .safe-right {
    padding-right: env(safe-area-inset-right);
  }
  .safe-all {
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom)
      env(safe-area-inset-left);
  }
}

/* 移动端底部导航安全区域 */
.mobile-nav-spacer {
  height: calc(64px + env(safe-area-inset-bottom, 0px));
}

@media (min-width: 768px) {
  .mobile-nav-spacer {
    display: none;
  }
}

/* 触摸优化 - 确保点击区域足够大 */
@media (hover: none) and (pointer: coarse) {
  .touch-target {
    min-width: 44px;
    min-height: 44px;
    touch-action: manipulation;
  }

  /* 移除 hover 延迟 */
  a,
  button {
    touch-action: manipulation;
  }
}

/* 防止移动端双击缩放 */
.mobile-no-tap-highlight {
  -webkit-tap-highlight-color: transparent;
}

/* 移动端滚动优化 */
.mobile-scroll {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: oklch(70% 0.008 270 / 30%);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: oklch(70% 0.008 270 / 50%);
}

/* ────────────────────────────────────────────────────────────────────────────
 * Touch Feedback for Mobile
 * ──────────────────────────────────────────────────────────────────────────── */

/* 移动端点击反馈 */
@media (hover: none) and (pointer: coarse) {
  /* 为所有交互元素添加默认点击样式 */
  button,
  a,
  [role="button"],
  .clickable {
    -webkit-tap-highlight-color: rgba(99, 102, 241, 0.2);
  }

  /* 移除移动端 hover 效果 */
  @supports not (background-color: oklch(0.95 0 0)) {
    .hover\:bg-zinc-50:hover {
      background-color: transparent;
    }
  }

  /* 添加 active 状态 */
  button:active,
  a:active,
  [role="button"]:active {
    opacity: 0.7;
  }
}

/* 平滑滚动 */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}

/* 文字选择优化 */
::selection {
  background-color: oklch(67% 0.14 268 / 20%);
  color: oklch(23% 0.09 268);
}
