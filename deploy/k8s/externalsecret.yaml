# ============================================
# ExternalSecret - 从 GitHub Secrets 同步到 K8s Secrets
# ============================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: nexusnote-secrets
  namespace: nexusnote
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: github-secrets
    kind: SecretStore
  target:
    name: nexusnote-secrets
    creationPolicy: Owner
  data:
    # 数据库配置
    - secretKey: POSTGRES_PASSWORD
      remoteRef:
        key: POSTGRES_PASSWORD
    - secretKey: DATABASE_URL
      remoteRef:
        key: DATABASE_URL

    # Redis 配置
    - secretKey: REDIS_URL
      remoteRef:
        key: REDIS_URL

    # 认证配置
    - secretKey: AUTH_SECRET
      remoteRef:
        key: AUTH_SECRET
    - secretKey: JWT_SECRET
      remoteRef:
        key: JWT_SECRET

    # AI 服务配置
    - secretKey: AI_PROVIDER
      remoteRef:
        key: AI_PROVIDER
    - secretKey: AI_302_API_KEY
      remoteRef:
        key: AI_302_API_KEY
    - secretKey: DEEPSEEK_API_KEY
      remoteRef:
        key: DEEPSEEK_API_KEY
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: OPENAI_API_KEY
    - secretKey: SILICONFLOW_API_KEY
      remoteRef:
        key: SILICONFLOW_API_KEY
    - secretKey: TAVILY_API_KEY
      remoteRef:
        key: TAVILY_API_KEY

    # Langfuse 配置
    - secretKey: LANGFUSE_PUBLIC_KEY
      remoteRef:
        key: LANGFUSE_PUBLIC_KEY
    - secretKey: LANGFUSE_SECRET_KEY
      remoteRef:
        key: LANGFUSE_SECRET_KEY
    - secretKey: LANGFUSE_BASE_URL
      remoteRef:
        key: LANGFUSE_BASE_URL
