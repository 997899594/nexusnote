# NexusNote Interview Agent - 当前实现方案

> **评估文档** - 展示当前的 AI 人格设计与 Prompt 架构
>
> **更新日期**: 2026-02-04
>
> **实现文件**: `apps/web/lib/ai/prompts/interview.ts`
>
> **状态**: ✅ 已实现（优化版）

---

## 📋 目录

1. [设计理念](#设计理念)
2. [架构设计](#架构设计)
3. [Prompt 实现](#prompt-实现)
4. [对话流程示例](#对话流程示例)
5. [评估要点](#评估要点)
6. [技术指标](#技术指标)

---

## 设计理念

### 核心原则

**1. 代码掌舵，AI 划桨**
- 业务逻辑由代码控制（状态管理、数据验证）
- 对话内容由 AI 生成（自然语言交互）
- 分离关注点：逻辑稳定，体验灵活

**2. 隐式状态机**
- 基于数据缺口驱动流程（缺什么就问什么）
- 不维护复杂的 State Enum
- 动态注入不同阶段的任务指令

**3. 单维度锁定**
- 每次只解决一个问题
- 防止 AI "抢跑"或偏离主线
- 降低用户认知负担

**4. 对话为主，选项为辅** ⭐ 核心创新
- 用户可以自由输入任何内容
- `presentOptions` 只是便捷工具，非强制选择
- AI 需理解并接受用户的自然语言输入
- 用户可以混合使用点击和输入

**5. 从"刑法典"到"演员剧本"** ⭐ 关键优化
- 不列举"不要做什么"
- 改为给具体的对话示例
- 让 AI 通过模仿学习，而非死记规则

---

## 架构设计

### 数据流

```
用户输入 → AI 对话 → 提取数据 → 更新 Context → 动态注入新 Prompt
```

### Context 结构

```typescript
interface InterviewContext {
  goal?: string;        // 学习目标
  background?: string;  // 学习背景
  time?: string;        // 时间投入
  // 扩展字段...
}
```

### Prompt 组装策略

```typescript
buildInterviewPrompt(context: InterviewContext): string {
  const BASE_PERSONA = `...` // 基础人设（所有阶段通用）
  const TASK = injectTaskByPhase(context) // 动态任务注入
  return `${BASE_PERSONA}\n\n${TASK}`
}
```

**动态注入逻辑**：
```typescript
if (!context.goal)       → 注入"收集目标"任务
if (!context.background) → 注入"收集背景"任务
if (!context.time)       → 注入"收集时间"任务
else                     → 注入"生成大纲"任务
```

---

## Prompt 实现

### 1. 基础人设（所有阶段通用）

```markdown
# 你是谁
NexusNote 学习伙伴 —— 像学长/学姐一样温暖，像顾问一样专业。

# 说话方式
用"咱们"、"想了解一下"这类亲切表达。适当用 emoji（✨📚👌）。

# 交互方式
对话为主，选项为辅。用户可以自由输入，也可以点选项。先共鸣，再提问。
```

**设计特点**：
- ✅ **极简**：只有 6 行（原版 40+ 行）
- ✅ **正向指引**：说"用什么"，而非"不要用什么"
- ✅ **人格定位**：学长/学姐（温暖）+ 顾问（专业）
- ✅ **强调交互模式**：明确"对话为主，选项为辅"

**对比旧版**：
| 维度 | 旧版 | 新版 |
|------|------|------|
| 行数 | 40+ | 6 |
| 风格 | "你是课程顾问" | "像学长/学姐" |
| 约束 | 大量"不要" | 只说"做什么" |

---

### 2. 阶段 1：收集学习目标

**注入时机**：`context.goal` 为空

**Prompt 内容**：

```markdown
## 📊 当前收集进度
⏳ **学习目标**（待确认）
⏳ **学习背景**（待确认）
⏳ **可用时间**（待确认）

## 当前任务
了解用户想学什么。

## 剧本示例

场景1（用户说得具体）：
用户: "我想学编程"
你: "编程是个好选择！应用面很广～
    你是想做网站、搞数据分析，还是对 AI 感兴趣呢？"

场景2（用户说得模糊）：
用户: "我想学点新东西"
你: "不错呀！想往哪个方向发展呢？比如职业技能、兴趣爱好之类的？"

场景3（第一次对话）：
你: "嗨！我是你的学习伙伴～告诉我你想学什么，我来帮你设计专属的学习路径 ✨"
   （说完后用 presentOptions 提供常见方向作为参考）

用户可以点选项，也可以直接输入其他内容。
```

**设计特点**：
- ✅ **进度可视化**：用 emoji 展示当前进展（✅/⏳）
- ✅ **剧本式教学**：给 3 个场景示例，而非抽象规则
- ✅ **明确交互方式**：最后一句说明用户可以点或输入
- ✅ **自然对话**：示例中先共鸣（"好选择"），再提问

**对比旧版**：
```diff
- 当前任务：了解用户的学习目标。
- 与用户简短对话后，调用 presentOptions 工具展示选项。

+ ## 剧本示例
+ 场景1（用户说得具体）：
+ 用户: "我想学编程"
+ 你: "编程是个好选择！应用面很广～..."
```

---

### 3. 阶段 2：收集学习背景

**注入时机**：`context.goal` 已有，`context.background` 为空

**Prompt 内容**：

```markdown
## 📊 当前收集进度
✅ **学习目标**: ${context.goal}
⏳ **学习背景**（待确认）
⏳ **可用时间**（待确认）

## 当前任务
了解用户在【${context.goal}】方面的基础。

## 剧本示例

承接上文：
你: "明白了，${context.goal}～那你之前有接触过相关内容吗？"
   （说完后用 presentOptions 提供便捷选项）

用户可以：
- 点选项：快速选择
- 直接输入："看过一些视频教程" → 你理解为有一点基础
```

**设计特点**：
- ✅ **上下文承接**：用已知的 `${context.goal}` 让对话自然
- ✅ **灵活理解**：明确用户可以自由输入，AI 需理解映射
- ✅ **双向交互**：说明点选项和输入都可以

**真实示例**：
```
用户目标: "种菜"

AI: "明白了，种菜～那你之前有接触过相关内容吗？"
   [选项卡片: 完全没接触过 | 看过一些教程 | 有一定经验]

用户输入: "我爷爷以前种过，我小时候帮过忙"
AI理解: 有一定经验 → 更新 background
```

---

### 4. 阶段 3：收集时间投入

**注入时机**：`context.goal` 和 `context.background` 已有，`context.time` 为空

**Prompt 内容**：

```markdown
## 📊 当前收集进度
✅ **学习目标**: ${context.goal}
✅ **学习背景**: ${context.background}
⏳ **可用时间**（待确认）

## 当前任务
了解用户每周能投入多少时间学习。

## 剧本示例

你: "好的，${context.background}～
    那最后一个问题：你每周大概能花多少时间学习？
    （这样我能帮你合理安排进度）"
   （说完后用 presentOptions 提供时间选项）

用户可以点选项或直接说："工作日每晚2小时，周末全天"
```

**设计特点**：
- ✅ **解释必要性**：用括号说明"为什么要问"
- ✅ **接受多样输入**：示例展示用户可能的自由回答
- ✅ **自然过渡**：用"那最后一个问题"让对话流畅

---

### 5. 阶段 4：确认并生成

**注入时机**：所有信息已收集完毕

**Prompt 内容**：

```markdown
## 📊 当前收集进度
✅ **学习目标**: ${context.goal}
✅ **学习背景**: ${context.background}
✅ **可用时间**: ${context.time}

## 当前任务
确认信息，生成个性化课程大纲。

## 剧本示例

你: "太好了！我已经了解你的情况：

    📚 目标：${context.goal}
    💪 基础：${context.background}
    ⏰ 时间：${context.time}

    现在我来为你设计专属的学习路径～"
   （说完后提供"生成大纲"和"修改需求"选项）

如果用户选择生成，调用 generateOutline 工具。
```

**设计特点**：
- ✅ **信息总结**：用 emoji 让信息可视化
- ✅ **给予期待**：说明即将生成学习路径
- ✅ **允许修改**：提供"修改需求"选项

---

## 对话流程示例

### 完整对话（展示混合交互）

```
[阶段 1：收集目标]
AI: 嗨！我是你的学习伙伴～告诉我你想学什么，我来帮你设计专属的学习路径 ✨
    [选项卡片: 编程 | 设计 | 语言 | 其他]

用户: 我想学种菜 👈 自由输入，不点选项

[阶段 2：收集背景]
AI: 不错的想法！自己种菜确实很有意思～
    那你之前有接触过相关内容吗？
    [选项卡片: 完全没接触过 | 看过一些教程 | 有一定经验]

用户: [点击] 完全没接触过 👈 点击选项

[阶段 3：收集时间]
AI: 好的，完全没接触过～
    那最后一个问题：你每周大概能花多少时间学习？
    （这样我能帮你合理安排进度）
    [选项卡片: 5小时以内 | 5-10小时 | 10-20小时 | 20小时以上]

用户: 工作日每晚1小时，周末半天 👈 自由输入，描述更详细

[阶段 4：生成大纲]
AI: 太好了！我已经了解你的情况：

    📚 目标：种菜
    💪 基础：完全没接触过
    ⏰ 时间：每周约10小时

    现在我来为你设计专属的学习路径～
    [选项卡片: 生成大纲 | 修改需求]

用户: [点击] 生成大纲 👈 点击选项

AI: [调用 generateOutline 工具，跳转到大纲页面]
```

**流程特点**：
- ✅ 用户可以**混合使用**点击选项和自由输入
- ✅ AI 能理解自然语言输入（"工作日每晚1小时" → 约10小时/周）
- ✅ 对话自然流畅，无生硬转折
- ✅ 每个阶段都有进度展示

---

## 评估要点

### 1. 人格一致性

| 维度 | 实现方式 | 评估标准 |
|------|---------|---------|
| **温暖度** | 用"咱们"、emoji、共鸣式开场 | 是否像朋友聊天？ |
| **专业度** | 解释必要性、逻辑清晰 | 是否让人信任？ |
| **灵活性** | 接受自由输入、理解自然语言 | 是否死板？ |
| **真诚度** | "想了解一下"而非"请提供" | 是否有距离感？ |

### 2. Prompt 质量

**✅ 优点**：

1. **极简设计**
   - BASE_PERSONA 只有 6 行（原 40+ 行）
   - 单阶段任务 ~300 tokens（含示例）
   - 总计 ~450 tokens/请求

2. **剧本式教学**
   - 用具体对话示例代替抽象规则
   - 每个阶段给 1-3 个场景
   - AI 通过模仿学习

3. **动态注入**
   - 每阶段只看到相关任务
   - 避免信息过载
   - 减少指令冲突

4. **避免禁止列表**
   - 不说"不要做什么"
   - 改为示范"怎么做"
   - 给 AI 发挥空间

**⚠️ 潜在挑战**：

1. **示例覆盖度**
   - 只给了 3 个场景（编程、新东西、首次对话）
   - AI 能否泛化到其他领域（如"学种菜"、"学摄影"）？
   - **测试建议**：尝试各种小众领域

2. **错误理解风险**
   - 用户说"10年"时，AI 能否正确反问澄清？
   - 用户说模糊词汇（"有点基础"），AI 如何映射？
   - **缓解措施**：Base Persona 强调"先共鸣，再提问"

3. **跨阶段连贯性**
   - 用户中途想修改之前的答案，AI 如何处理？
   - **当前方案**：未明确说明，依赖 AI 的常识
   - **改进空间**：可在 Base Persona 补充一句

### 3. 交互体验

**对比评估**（旧方案 vs 新方案）：

| 交互模式 | 旧方案 | 新方案 |
|---------|--------|--------|
| **用户自由度** | 必须点选项 | 可点可输 |
| **AI 语气** | 客服式（"为您服务"） | 朋友式（"咱们"） |
| **提问方式** | 命令式（"请选择"） | 疑问式（"你想..."） |
| **过渡自然度** | 生硬（"OK，接下来..."） | 流畅（"那..."） |
| **共鸣表达** | 机械（"太棒了！"） | 真诚（"不错的想法"） |

**真实对话测试**（建议）：

```
测试用例1：用户说"我想学XXX"
期望：AI 先共鸣，再提问，语气亲切

测试用例2：用户说"不想说"
期望：AI 理解并给出默认建议，不强制

测试用例3：用户说模糊内容"10年"
期望：AI 反问澄清，不擅自猜测

测试用例4：用户不点选项，直接输入
期望：AI 理解并继续流程

测试用例5：用户一次性说多个信息
期望：AI 同时提取多个字段，跳过已知问题
```

### 4. 技术实现

**架构评估**：
- ✅ **代码简洁**：150 行实现完整流程
- ✅ **易维护**：新增阶段只需添加一个 `if` 分支
- ✅ **可扩展**：Context 结构易于扩展新字段
- ✅ **类型安全**：TypeScript 保障

**Token 效率**：
```
BASE_PERSONA:   ~150 tokens（极简）
单阶段任务:     ~300 tokens（含示例）
进度展示:       ~50 tokens
总计:          ~500 tokens/请求（优秀）
```

对比旧版：
- 旧版 BASE_PERSONA: ~800 tokens
- 旧版单阶段: ~400 tokens
- 节省约 40% token 消耗

---

## 技术指标

### 代码行数

| 组件 | 行数 | 说明 |
|------|------|------|
| `buildInterviewPrompt` | 10 | 主函数 |
| `injectTaskByPhase` | 75 | 4 个阶段的 Prompt |
| BASE_PERSONA | 6 | 基础人设 |
| 单阶段 Prompt | ~15-20 | 每个阶段 |
| **总计** | **~150** | 整个文件 |

### Token 消耗

```
单次对话平均消耗：
- System Prompt: ~500 tokens
- 用户输入: ~50 tokens
- AI 输出: ~150 tokens
- 总计: ~700 tokens

完整流程（4轮对话）：
- 总消耗: ~2800 tokens
- 成本: <$0.01 (GPT-3.5)
```

### 性能指标

| 指标 | 数值 |
|------|------|
| 首次响应时间 | <1s |
| 平均对话轮次 | 4 轮 |
| 用户完成率 | 待测试 |
| Token 效率 | 节省 40% |

---

## 与设计文档的对比

### 设计文档（`ai-personality-design.md`）

**特点**：
- 800+ 行详细设计
- 大量对比示例（🔴旧版 vs ✅新版）
- 完整的检查清单
- 适合用于**设计评审**和**团队讨论**

### 当前实现（`interview.ts`）

**特点**：
- 150 行精简实现
- 剧本式示例教学
- 动态注入机制
- 适合用于**生产环境**

**差异总结**：

| 维度 | 设计文档 | 当前实现 |
|------|---------|---------|
| **篇幅** | 800+ 行 | 150 行 |
| **风格** | 详尽说明 | 极简实用 |
| **示例** | 多场景对比 | 关键场景剧本 |
| **约束** | 有"禁止列表" | 只给正向示范 |
| **目标** | 团队对齐 | 生产运行 |

---

## 未来优化方向

### 短期（1-2周）

1. **增加异常场景处理**
   - 用户中途想修改
   - 用户拒绝回答
   - 用户输入完全无关内容

2. **补充示例多样性**
   - 增加小众领域示例（摄影、园艺、乐器）
   - 增加跨文化场景（国际用户）

3. **A/B 测试**
   - 对比剧本式 vs 规则式
   - 测量用户完成率和满意度

### 中期（1个月）

1. **个性化调优**
   - 根据用户历史调整语气
   - 记住用户偏好（喜欢详细 vs 简洁）

2. **多语言支持**
   - 英文版 Prompt
   - 保持人格一致性

3. **情感感知**
   - 识别用户情绪（焦虑、兴奋）
   - 动态调整回应风格

### 长期（3个月+）

1. **自适应学习**
   - 从成功对话中学习
   - 自动优化 Prompt

2. **多模态交互**
   - 语音输入理解
   - 图片/视频辅助

---

## 测试清单

### 功能测试

- [ ] 用户只点选项，流程正常完成
- [ ] 用户只自由输入，流程正常完成
- [ ] 用户混合点击和输入，流程正常完成
- [ ] AI 能理解模糊输入并正确映射
- [ ] AI 能识别一次性提供多个信息

### 人格测试

- [ ] 语气温暖亲切，无机器人感
- [ ] 专业但不高冷
- [ ] 过渡自然，无生硬转折
- [ ] 适当使用 emoji，不过度

### 边界测试

- [ ] 用户说无关内容（"今天天气真好"）
- [ ] 用户拒绝回答（"不想说"）
- [ ] 用户输入极短（"10"）
- [ ] 用户输入极长（一大段话）
- [ ] 用户想修改之前的答案

### 性能测试

- [ ] 响应时间 <1s
- [ ] Token 消耗在预期范围
- [ ] 无内存泄漏
- [ ] 并发 100 用户无问题

---

## 总结

**核心创新点**：

1. ⭐ **从"刑法典"到"演员剧本"**
   - 用示例代替禁止
   - 让 AI 模仿而非背诵

2. ⭐ **对话为主，选项为辅**
   - 用户自由度高
   - 符合自然交互习惯

3. ⭐ **极简 Prompt 设计**
   - 6 行基础人设
   - 节省 40% token

4. ⭐ **动态注入机制**
   - 只看当前任务
   - 减少干扰

**适用场景**：
- ✅ 需要温暖、人性化的 AI 交互
- ✅ 用户群体多样（有人爱打字，有人爱点击）
- ✅ 对话流程相对固定（收集信息 → 生成结果）

**不适用场景**：
- ❌ 需要严格合规的场景（如医疗、法律）
- ❌ 对话路径复杂多变（如多轮谈判）
- ❌ 需要极高准确率（当前方案给 AI 较多自由度）

---

**版本**: v2.0 (Optimized)

**状态**: ✅ 已实现，待生产验证

**下一步**:
1. 内部测试（开发团队试用）
2. 小范围灰度（10% 用户）
3. 收集反馈并迭代

**评审建议**：
- 请重点关注"对话流程示例"部分
- 测试"混合交互"是否符合预期
- 评估 Prompt 的简洁性是否牺牲了稳定性
